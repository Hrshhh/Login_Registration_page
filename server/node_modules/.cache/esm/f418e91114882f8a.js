let bcrypt,User,jwt;_148‍.x([["register",()=>register],["login",()=>login]]);_148‍.w("bcrypt",[["default",["bcrypt"],function(v){bcrypt=v}]]);_148‍.w("../models/user",[["default",["User"],function(v){User=v}]]);_148‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);// export const message = (req, res) => {
//     res.status(200).send(`Message is ${req.params.message}`)
// };



require("dotenv").config();


       const register = async(req, res) => {
    _148‍.g.console.log(req.body);
    const {name, email, password} = req.body;

    if(!name) return res.status(400).send('Name is required')
    if(!password || password.length < 6) return res.status(400).send("Password is required or should be min 6 char long")

    let userExist = await User.findOne({email}).exec()
    if(userExist) return res.status(400).send("Email is taken")

    const user = new User(req.body);

    try{
        await user.save();
        _148‍.g.console.log("User created ", user);
        return res.json({ok: true})
    }
    catch(err){
        _148‍.g.console.log("Create user failed ",err);
        return res.status(400).send("Error try again")
    }
};

       const login = async(req, res) => {
    // console.log(req.body);
    const { email, password } = req.body;
    try{
        console.log("HI")
        let user = await User.findOne({ email }).exec();
        if(user == null) res.status(400).send("User with that email is not found");
        _148‍.g.console.log(user);
        if(user){
            user.comparePassword(password, function(err, match) {
                _148‍.g.console.log(err);
                if(!match || err) return res.status(400).send("Wrong Password");
                _148‍.g.console.log(process.env.JWT_SECRET)
                let token = jwt.sign({ _id: user._id }, process.env.JWT_SECRET, {
                    expiresIn: '5d'
                })
                res.json({token, user})
            });
        } 
    }
    catch(err){
        console.log("err")
        _148‍.g.console.log('Login err ', err);
        res.status(400).send("Sigin failed")
    }
}